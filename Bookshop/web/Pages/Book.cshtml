@page
@using Classes;
@model web.Pages.BookModel
@{
}


<div class="container">

    <div class="row">
        <div class="col-3">
            <div class="row">
                <img src="~/book.png" />
            </div>
            <div class="row mt-2 text-center">
                <div class="col">
                    <form method="post" asp-page-handler="OnPostUserOperations">
                        <input type="hidden" />
                        <button type="submit" class="btn btn-secondary border border-1 border-success rounded-pill" asp-page-handler="UserOperations"> Want to read</button>
                    </form>
                </div>
               
            </div>

        </div>
        <div class="col">
            <div class="row">
                @if (Model.Book.GetType() == typeof(PaperBook))
                {
                    var paperBook = (PaperBook)Model.Book;
                    <h1> @paperBook.Title</h1>
                    <h3> @string.Join(',',paperBook.Authors.Select(author => author.FullName))</h3>
                    <p>@paperBook.Description</p>
                    <h4>Publication year: @paperBook.PublicationDate</h4>
                    <h4>Publisher: @paperBook.Publisher</h4>
                    <h4>ISBN: @paperBook.ISBN</h4>
                    <h4>ISBN10: @paperBook.ISBN10</h4>
                }
                else if (Model.Book.GetType() == typeof(EBook))
                {
                    var ebook = (EBook)Model.Book;
                    <h1> @ebook.Title</h1>
                    <h3>@string.Join(',',ebook.Authors.Select(author => author.FullName))</h3>
                    <p>@ebook.Description</p>
                    <h4>Publication year: @ebook.PublicationDate</h4>
                    <h4>Publisher: @ebook.Publisher</h4>
                    <h4>Format: @ebook.Format</h4>
                    <h4>File size: @ebook.FileSize</h4>
                }
                <hr />
                <h2>Rating</h2>
            </div>
            <div class="row">
                <div class="col-10">
                    <div class="row">
                        <div class="col-2">
                            <h5>5 star</h5>
                        </div>
                        <div class="col-5 mt-1">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: @Model.Statistics.fiveStarReviewsPercentage%" aria-valuemin="0" aria-valuemax="100">@Model.Statistics.fiveStarReviewsPercentage %</div>
                            </div>
                        </div>
                        <div class="col-1">
                            <h5>(@Model.Statistics.fiveStarReviewsCount)</h5>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-2">
                            <h5>4 star</h5>
                        </div>
                        <div class="col-5 mt-1">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: @Model.Statistics.fourStarReviewsPercentage%" aria-valuemin="0" aria-valuemax="100">@Model.Statistics.fourStarReviewsPercentage %</div>
                            </div>
                        </div>
                        <div class="col-1">
                            <h5>(@Model.Statistics.fourStarReviewsCount)</h5>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-2">
                            <h5>3 star</h5>
                        </div>
                        <div class="col-5 mt-1">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: @Model.Statistics.threeStarReviewsPercentage%" aria-valuemin="0" aria-valuemax="100">@Model.Statistics.threeStarReviewsPercentage %</div>
                            </div>
                        </div>
                        <div class="col-1">
                            <h5>(@Model.Statistics.threeStarReviewsCount)</h5>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-2">
                            <h5>2 star</h5>
                        </div>
                        <div class="col-5 mt-1">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: @Model.Statistics.twoStarReviewsPercentage%" aria-valuemin="0" aria-valuemax="100">@Model.Statistics.twoStarReviewsPercentage %</div>
                            </div>
                        </div>
                        <div class="col-1">
                            <h5>(@Model.Statistics.twoStarReviewsCount)</h5>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-2">
                            <h5>1 star</h5>
                        </div>
                        <div class="col-5 mt-1">
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: @Model.Statistics.oneStarReviewsPercentage%" aria-valuemin="0" aria-valuemax="100">@Model.Statistics.oneStarReviewsPercentage %</div>
                            </div>
                        </div>
                        <div class="col-1">
                            <h5>(@Model.Statistics.oneStarReviewsCount)</h5>
                        </div>
                    </div>
                </div>
                <div class="col-2 text-center mt-5">
                    <div class="row">
                        <h4> @Model.Statistics.Average/5 &#11088;</h4>
                    </div>
                    <div class="row">
                        <p class="text-secondary">@Model.Statistics.ReviewCount reviews</p>
                    </div>

                </div>

            </div>
            
        </div>
    </div>
</div>
<hr />

<div class="container mt-5">
    <h2>Leave a Review</h2>

    <form method="post" asp-page-handler="OnPost">
        <div class="form-group">
            <label for="comment">Comment:</label>
            <textarea asp-for="NewReview.Comment" class="form-control" id="comment" name="Comment" rows="4" required></textarea>
        </div>

        <div class="form-group">
            <label for="rating">Rating:</label>
            <select asp-for="NewReview.Rating" class="form-control" id="rating" name="Rating" required>
                <option value="1">1 - Poor</option>
                <option value="2">2 - Fair</option>
                <option value="3">3 - Good</option>
                <option value="4">4 - Very Good</option>
                <option value="5">5 - Excellent</option>
            </select>
        </div>

        <!-- You may add more fields as needed -->

        <div class="form-group">
            <input type="hidden" value="@Model.Book.Id" name="bookId" />
            <button type="submit" class="btn btn-primary" asp-page-handler="OnPost">Submit Review</button>
        </div>
    </form>
</div>

<div class="container">
    @foreach (var review in Model.Book.GetReviews())
    {
        <div class="card">
            <h4>@review.User.Name</h4><p>(@review.User.Username)</p>
            <h4>@review.Comment</h4>
            <h4>@review.Rating</h4>
        </div>

    }
</div>